(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e2ba35e"],{4379:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"填写信息",name:"first"}},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.doc,rules:e.rules,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"标题",prop:"docName"}},[r("el-input",{model:{value:e.doc.docName,callback:function(t){e.$set(e.doc,"docName",t)},expression:"doc.docName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"描述",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:4}},model:{value:e.doc.remark,callback:function(t){e.$set(e.doc,"remark",t)},expression:"doc.remark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"审批人选择"}},[r("el-select",{attrs:{placeholder:"请选择审批人",filterable:""},on:{change:function(t){return e.selectApprove()}},model:{value:e.doc.approve,callback:function(t){e.$set(e.doc,"approve",t)},expression:"doc.approve"}},e._l(e.options,(function(e){return r("el-option",{key:e.userId,attrs:{label:e.staffName,value:e}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"已选择审批人",prop:"approveList"}},e._l(e.doc.approveList,(function(t){return r("el-tag",{key:t.userName,staticStyle:{"margin-right":"10px"},attrs:{closable:""},on:{close:function(r){return e.handleClose(t)}}},[e._v(e._s(t.staffName))])})),1),e._v(" "),r("el-form-item",[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"",action:e.action,"file-list":e.fileList,multiple:""}},[r("i",{staticClass:"el-icon-upload"}),e._v(" "),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),r("em",[e._v("点击上传")])]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("上传文件不超过100MB")])])],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("提交审批")])],1)],1)],1)],1)],1)},a=[],i=(r("9a33"),r("6d57"),r("663e")),n=r("c24f"),s={name:"uploadDoc",data:function(){return{activeName:"first",dialogVisible:!1,formInline:{user:"",region:""},doc:{docName:"",remark:"",approve:"",approveList:[]},rules:{docName:[{required:!0,message:"请输入文件名称",trigger:"blur"},{min:3,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],remark:[{required:!0,message:"请填写文件描述",trigger:"blur"}],approveList:[{required:!0,message:"请选择审批人",trigger:"change"}]},fileList:[],options:[],value:[],action:"",pageNum:1,pageSize:1e3,tags:[]}},mounted:function(){this.action=window.location.protocol+"//"+window.location.host+"/electronic/file/uploadFile",this.queryUserList()},methods:{handleClick:function(){},submitUpload:function(){this.$refs.upload.submit()},selectApprove:function(){var e=this,t=!1;this.doc.approveList.forEach((function(r){r==e.doc.approve&&(t=!0)})),t||this.doc.approveList.push(this.doc.approve),this.doc.approve=""},handleClose:function(e){this.doc.approveList.splice(this.doc.approveList.indexOf(e),1)},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.open()}))},submitDoc:function(){var e=this,t=[],r=[],o=this.$refs.upload.uploadFiles;if(0!=o.length){for(var a=0;a<o.length;a++)t.push({docName:o[a].response.result.fileName.split("&&")[1],docUrl:decodeURI(o[a].response.result.fileDownloadUri),docType:o[a].response.result.fileType,docRandomName:o[a].response.result.fileName});for(var n=0;n<this.doc.approveList.length;n++)r.push({userId:this.doc.approveList[n].userId,nodeOrder:n+1});Object(i["g"])({workOrderName:this.doc.docName,workOrderDesc:this.doc.remark,workInfo:JSON.stringify(t),workType:"doc",workNodeList:JSON.stringify(r)}).then((function(t){e.$loading().close(),t.success?(e.$message({type:"success",message:"操作成功"}),e.$router.push({path:"/workorder/workdoc"})):e.$message({type:"error",message:"提交失败"})}))}else this.$message({message:"请上传文件",type:"warning"})},onSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.submit()}))},queryUserList:function(e){var t=this;Object(n["f"])({pageSize:this.pageSize,pageNum:this.pageNum,userName:e}).then((function(e){t.$loading().close(),e.success&&(t.options=e.result.result)}))},open:function(){var e=this;this.$confirm("确定提交审批?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.submitDoc()}))}}},l=s,c=(r("a1b3"),r("e90a")),u=Object(c["a"])(l,o,a,!1,null,"4cfd7cbd",null);t["default"]=u.exports},"663e":function(e,t,r){"use strict";r.d(t,"g",(function(){return a})),r.d(t,"d",(function(){return i})),r.d(t,"f",(function(){return n})),r.d(t,"e",(function(){return s})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var o=r("b775");function a(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/startWorkOrder",method:"post",loading:t,data:e})}function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/queryWorkOrder",method:"post",loading:t,data:e})}function n(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/queryWorkOrderToMe",method:"post",loading:t,data:e})}function s(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/queryWorkOrderDetail",method:"post",loading:t,data:e})}function l(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/approveWorkOrder",method:"post",loading:t,data:e})}function c(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/approverCarbonCopy",method:"post",loading:t,data:e})}function u(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(o["a"])({url:"/electronic/workOrder/queryApproverCarbonCopy",method:"post",loading:t,data:e})}},a1b3:function(e,t,r){"use strict";var o=r("fd62"),a=r.n(o);a.a},fd62:function(e,t,r){}}]);